# Whose Code is it Anyway?

* Author: Luis Pérez
* Link: https://engineeringblog.yelp.com/2021/01/whose-code-is-it-anyway.html

Yelp 建设了一个 Code Ownership 系统来追踪每一行代码的归属，这个系统可以很好地与 PagerDuty、Jira 一起合作去减少不同团队之间沟通的复杂性。

## 梗概
1. yelp引入代码ownership的背景是，公司想要建立工程能力度量标准的机制，以便与深入了解产品团队如何快速有效地传递代码。这就需要代码与owner做匹配，无论是组织、团队、个人，代码一旦有了owner，就可以很方便地收集工程能力的数据，确定能够改善代码的通用方向。
2. 找到代码的owner还是相对来说有点麻烦的，因为代码的所有权可能落在各式各样的群体或者个人身上。而团队的流通性是非常大的，比如个人离职或者团队拆分重组。因此我们要求每当团队和个人发生调整时，代码的owner也要相应地发生调整。
3. 建立代码owner机制除了能完善工程能力建设以外，还会有一些潜在的好处：
- 有助于更好地作出计划，了解产品的bug归属、feature构建、无用功能的废弃，产品依赖方也可以通过这些计划更好地规划自己的产品。
- 有助于监控和报警问题，监控报警可以定向地向owner进行推送，保证监控到达的准确性。
- 有助于跨组织合作，明确了ownership之后，公司内有能力的工程师也可以协助代码库的修复，更方便地为代码库提供 bugfix的pr
- 减少重复工作，做迁移和基础设施升级的时候。由于明确了ownership，可以通过中心化的管理方式，统一使用一套方法。减少一些重复的工作，而非各个代码产品各干各的。
- 避免没人长期没人维护但是却在线上起关键作用的模块丢失维护信息。
4. 通过创建YMFL配置文件来配置任何git库、api、测试用例甚至debian包，从而配置代码的ownership。在比较常见的git库中，配置了一些pre-commit的hook，保证这些文件存在。
5. 当代码中建立好ownership配置文件之后，启动batch任务来定时读取配置文件，并将其写入数据并生成ownership service API以便与其他服务进行调用。
6. 利用ownership service API可以可视化地搭建应用来展示ownership信息，当其发生变更时也会对应的显示在应用中，查询这些信息就会变得更加容易。


## 感悟
1. yelp这套ownership机制整体来看还是比较完善，不需要动辄去梳理模块归属，也很方便地去找其他团队的依赖维护者。有了ownership系统之后，对于很多针对性的工程能力或者基础库的建设也可以更中心化地去实施。
2. 但是这里有个比较严重的问题在于依赖于人工来编辑YMFL，当频繁变更ownership的时候，这个文件的更新可能会出现滞后或者停止维护的情况。如果能从代码库管理的层面直接来做这个事情比较好，每个代码库都有自己的owner，owner变更的时候直接移交代码库。没有权限也就没办法来维护更新代码，这样做强迫开发人员及时更新ownership。